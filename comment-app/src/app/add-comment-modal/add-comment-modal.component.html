<div *ngIf="isVisible" class="modal fade show d-block" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Додати коментар</h5>
        <button type="button" class="close ml-auto" aria-label="Close" (click)="closeModal()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form (ngSubmit)="onSubmit()">
        <div class="modal-body">
          <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>
          <div *ngIf="externalErrorMessage" class="alert alert-danger">{{ externalErrorMessage }}</div>

          <div class="toolbar btn-group mt-2 mb-2" role="group" aria-label="Text formatting toolbar">
            <button type="button" class="btn btn-outline-secondary btn-sm mr-2" (click)="insertTag('i')">[i]</button>
            <button type="button" class="btn btn-outline-secondary btn-sm mr-2" (click)="insertTag('strong')">[strong]</button>
            <button type="button" class="btn btn-outline-secondary btn-sm mr-2" (click)="insertTag('code')">[code]</button>
            <button type="button" class="btn btn-outline-secondary btn-sm mr-2" (click)="insertTag('a', 'href=&quot;https://example.com&quot;')">[a]</button>
            <button type="button" class="btn btn-outline-danger btn-sm" (click)="undoLastInsert()">Скасувати останню вставку</button>
          </div>

          <div class="form-group">
            <label for="commentText">Текст коментаря:</label>
            <textarea id="commentText" [(ngModel)]="commentText" name="commentText" class="form-control" rows="5" required></textarea>
          </div>

          <div class="form-group">
            <label for="file">Файл:</label>
            <input type="file" (change)="onFileSelected($event)" class="form-control-file" accept=".jpg, .jpeg, .png, .gif, .txt" />
            <small class="form-text text-muted">Допустимі формати: JPG, GIF, PNG (320x240) або TXT (до 100 КБ)</small>
          </div>

          <div *ngIf="filePreviewUrl && isFileValid" class="text-center mt-3">
            <img [src]="filePreviewUrl" alt="Preview" class="img-thumbnail" style="max-width: 320px; max-height: 240px;" />
          </div>

          <div class="captcha-container form-group d-flex align-items-center mt-3">
            <img [src]="captchaUrl" alt="CAPTCHA" class="captcha-image mr-3" style="max-width: 120px; height: auto;" />
            <input
              type="text"
              [(ngModel)]="captcha"
              name="captcha"
              class="form-control mr-3"
              placeholder="Введіть CAPTCHA"
              required
            />
            <button type="button" (click)="refreshCaptcha()" class="btn btn-secondary btn-sm ml-2">Оновити CAPTCHA</button>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-primary"
                  [disabled]="!commentText || !captcha || !isFileValid">Додати</button>
          <button type="button" class="btn btn-secondary" (click)="closeModal()">Закрити</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div *ngIf="isVisible" class="modal-backdrop fade show"></div>
